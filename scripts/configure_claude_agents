#!/usr/bin/env bash

set -euo pipefail

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Paths
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(dirname "$SCRIPT_DIR")"
SOURCE_DIR="$REPO_ROOT/templates/.claude/agents"
TARGET_DIR="$HOME/.claude/agents"

echo -e "${GREEN}Configuring Claude agents...${NC}"

# Check if source directory exists
if [[ ! -d "$SOURCE_DIR" ]]; then
    echo -e "${RED}Error: Source directory $SOURCE_DIR does not exist${NC}"
    exit 1
fi

# Create target directory if it doesn't exist
if [[ ! -d "$TARGET_DIR" ]]; then
    echo -e "${YELLOW}Creating directory: $TARGET_DIR${NC}"
    mkdir -p "$TARGET_DIR"
fi

# Copy all agent files
echo -e "${GREEN}Copying agent files...${NC}"
for agent_file in "$SOURCE_DIR"/*.md; do
    if [[ -f "$agent_file" ]]; then
        filename=$(basename "$agent_file")
        echo "  - Copying $filename"
        cp "$agent_file" "$TARGET_DIR/"
    fi
done

# Count copied files
agent_count=$(find "$TARGET_DIR" -name "*.md" -type f | wc -l | tr -d ' ')

echo -e "${GREEN}âœ“ Successfully installed $agent_count Claude agent(s) to $TARGET_DIR${NC}"
echo ""
echo "Available agents:"
for agent_file in "$TARGET_DIR"/*.md; do
    if [[ -f "$agent_file" ]]; then
        filename=$(basename "$agent_file" .md)
        echo "  - $filename"
    fi
done

echo ""
echo -e "${GREEN}Claude agents configuration complete!${NC}"
echo "The agents are now available for use in Claude Code."
